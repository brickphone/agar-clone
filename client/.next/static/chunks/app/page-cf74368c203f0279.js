(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4489:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var s=i(5793),n=i(6869);let r=null,o=0,l=0,h=1e3/60,a=null,c=null,u=new WeakMap;class d{key(e,t){return"".concat(e,",").concat(t)}toIndex(e,t){return{ix:Math.floor(e/this.cellSize),iy:Math.floor(t/this.cellSize)}}insert(e){let{ix:t,iy:i}=this.toIndex(e.x,e.y),s=this.key(t,i),n=this.cells.get(s);n||this.cells.set(s,n=new Set),n.add(e)}remove(e){let{ix:t,iy:i}=this.toIndex(e.x,e.y),s=this.key(t,i),n=this.cells.get(s);n&&n.delete(e)}update(e,t,i){let s=this.toIndex(t,i),n=this.toIndex(e.x,e.y);if(s.ix===n.ix&&s.iy===n.iy)return;let r=this.key(s.ix,s.iy),o=this.key(n.ix,n.iy),l=this.cells.get(r);l&&l.delete(e);let h=this.cells.get(o);h||this.cells.set(o,h=new Set),h.add(e)}query(e){let t=this.toIndex(e.x0,e.y0),i=this.toIndex(e.x1,e.y1),s=[];for(let e=t.iy;e<=i.iy;e++)for(let n=t.ix;n<=i.ix;n++){let t=this.cells.get(this.key(n,e));if(t)for(let e of t)s.push(e)}return s}constructor(e=64){this.cells=new Map,this.cellSize=e}}class x{next(){let e=this.state+=0x6d2b79f5;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/0x100000000}nextInt(e){return Math.floor(this.next()*e)}nextRange(e,t){return e+this.next()*(t-e)}constructor(e){this.state=e>>>0}}let y={width:5e3,height:5e3},f={minRadius:2,maxSpeed:6,minSpeed:1.5};class v{createFood(e){for(let t=0;t<e;t++){let e=this.nextId++,t=this.rng.nextRange(0,y.width),i={id:e,kind:2,x:t,y:this.rng.nextRange(0,y.height),r:2+this.rng.nextRange(0,1)};this.bodies.set(e,i),this.grid.insert(i)}}createCell(e,t,i,s){let n=this.nextId++,r={id:n,kind:1,x:i,y:s,r:Math.max(f.minRadius,Math.sqrt(t/Math.PI)),mass:t,vx:0,vy:0,ownerId:e,canMergeAt:0};return this.bodies.set(n,r),this.grid.insert(r),n}query(e){return this.grid.query(e)}step(e){for(let t of this.bodies.values())if(void 0!==t.mass){let i=function(e){let t=Math.max(1,Math.log10(e+10));return Math.max(f.minSpeed,f.maxSpeed/t)}(t.mass),s=t.x,n=t.y;t.x+=t.vx*i*e,t.y+=t.vy*i*e,t.x=Math.max(t.r,Math.min(y.width-t.r,t.x)),t.y=Math.max(t.r,Math.min(y.height-t.r,t.y)),this.grid.update(t,s,n)}}constructor(e=1234){this.bodies=new Map,this.nextId=1,this.grid=new d(64),this.rng=new x(e)}}function m(e){return"mass"in e&&"vx"in e&&"vy"in e}class g{follow(e,t){this.position.x+=(e.x-this.position.x)*Math.min(1,10*t),this.position.y+=(e.y-this.position.y)*Math.min(1,10*t)}setZoomForMass(e){let t=1/Math.max(1,Math.log10(e+10));this.zoom=Math.min(1.5,Math.max(.4,t))}constructor(){this.position={x:0,y:0},this.zoom=1}}class w{attach(e){this.canvas=e;let t=e.getContext("2d");if(!t)throw Error("2D context not available");this.ctx=t,this.resize()}resize(){if(!this.canvas||!this.ctx)return;this.dpr=window.devicePixelRatio||1;let{width:e,height:t}=this.canvas.getBoundingClientRect();this.canvas.width=Math.max(1,Math.floor(e*this.dpr)),this.canvas.height=Math.max(1,Math.floor(t*this.dpr)),this.ctx.setTransform(this.dpr,0,0,this.dpr,0,0)}draw(e,t){if(!this.canvas||!this.ctx)return;let i=this.ctx,{width:s,height:n}=this.canvas.getBoundingClientRect();i.clearRect(0,0,s,n),i.save(),i.translate(s/2,n/2),i.scale(t.zoom,t.zoom),i.translate(-t.position.x,-t.position.y),i.save(),i.strokeStyle="rgba(255,255,255,0.05)",i.lineWidth=1/t.zoom;let r=64*Math.floor((t.position.x-s)/64)-320,o=r+2*s+640,l=64*Math.floor((t.position.y-n)/64)-320,h=l+2*n+640;for(let e=r;e<=o;e+=64)i.beginPath(),i.moveTo(e,l),i.lineTo(e,h),i.stroke();for(let e=l;e<=h;e+=64)i.beginPath(),i.moveTo(r,e),i.lineTo(o,e),i.stroke();for(let t of(i.restore(),e.slice().sort((e,t)=>e.r-t.r)))i.beginPath(),i.arc(t.x,t.y,t.r,0,2*Math.PI),1===t.kind?i.fillStyle="#5eead4":2===t.kind?i.fillStyle="#fde047":i.fillStyle="#fca5a5",i.fill();i.restore()}constructor(){this.ctx=null,this.canvas=null,this.dpr=1}}function p(){let e=(0,n.useRef)(()=>{}),t=(0,n.useRef)(null),i=(0,n.useRef)(null);return(0,n.useEffect)(()=>{t.current&&function(e){if(a)return;a={keys:new Set,mouse:null,touchId:null,touchOrigin:null,touchPos:null,prevButtons:{split:!1,eject:!1}},c=e;let t=e=>{a.keys.add(e.key.toLowerCase())},i=e=>{a.keys.delete(e.key.toLowerCase())},s=e=>{if(!c)return;let t=c.getBoundingClientRect(),i=t.left+t.width/2,s=t.top+t.height/2;a.mouse={x:e.clientX-i,y:e.clientY-s}},n=e=>{if(null!==a.touchId)return;let t=e.changedTouches[0];a.touchId=t.identifier,a.touchOrigin={x:t.clientX,y:t.clientY},a.touchPos={x:t.clientX,y:t.clientY}},r=e=>{if(null!==a.touchId)for(let t=0;t<e.changedTouches.length;t++){let i=e.changedTouches[t];if(i.identifier===a.touchId){a.touchPos={x:i.clientX,y:i.clientY};break}}},o=e=>{if(null!==a.touchId){for(let t=0;t<e.changedTouches.length;t++)if(e.changedTouches[t].identifier===a.touchId){a.touchId=null,a.touchOrigin=null,a.touchPos=null;break}}};window.addEventListener("keydown",t),window.addEventListener("keyup",i),window.addEventListener("mousemove",s),e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchmove",r,{passive:!0}),e.addEventListener("touchend",o,{passive:!0}),e.addEventListener("touchcancel",o,{passive:!0}),u.set(e,()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",i),window.removeEventListener("mousemove",s),e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",r),e.removeEventListener("touchend",o),e.removeEventListener("touchcancel",o),c=null,a=null})}(t.current);let s=new v(123);s.createFood(300);let n=s.createCell(1,100,2500,2500),d=new g,x=new w;if(i.current){x.attach(i.current);let t=()=>x.resize();return window.addEventListener("resize",t),e.current=function(e,t){null!==r&&cancelAnimationFrame(r),o=performance.now(),l=0;let i=s=>{let n=s-o;for(o=s,n>100&&(n=100),l+=n;l>=h;)e(h/1e3),l-=h;t(l/h),r=requestAnimationFrame(i)};return r=requestAnimationFrame(i),()=>{null!==r&&cancelAnimationFrame(r),r=null}}(e=>{var t;let i=function(){if(!a)return{desiredDirection:{x:0,y:0},magnitude:0,buttons:{splitPressed:!1,splitJustPressed:!1,ejectPressed:!1,ejectJustPressed:!1}};let e=a&&c?a.mouse?a.mouse:a.touchOrigin&&a.touchPos?{x:a.touchPos.x-a.touchOrigin.x,y:a.touchPos.y-a.touchOrigin.y}:null:null,t={x:0,y:0};if(e)t=e;else{var i;let e,s;i=a.keys,e=0,s=0,(i.has("a")||i.has("arrowleft"))&&(e-=1),(i.has("d")||i.has("arrowright"))&&(e+=1),(i.has("w")||i.has("arrowup"))&&(s-=1),(i.has("s")||i.has("arrowdown"))&&(s+=1),t={x:e,y:s}}let{v:s,mag:n}=function(e){let t=Math.hypot(e.x,e.y);return 0===t?{v:{x:0,y:0},mag:0}:{v:{x:e.x/t,y:e.y/t},mag:Math.min(1,t>1?1:t)}}(t),r=a.keys.has(" ")||a.keys.has("space"),o=a.keys.has("w"),l=r&&!a.prevButtons.split,h=o&&!a.prevButtons.eject;return a.prevButtons={split:r,eject:o},{desiredDirection:s,magnitude:n>1?1:n,buttons:{splitPressed:r,splitJustPressed:l,ejectPressed:o,ejectJustPressed:h}}}(),r=s.bodies.get(n);r&&m(r)&&(r.vx=(t=i.desiredDirection).x,r.vy=t.y),s.step(e),r&&m(r)&&(d.follow({x:r.x,y:r.y},e),d.setZoomForMass(r.mass))},()=>{x.draw(Array.from(s.bodies.values()),d)}),()=>{e.current&&e.current(),window.removeEventListener("resize",t)}}return()=>{if(e.current&&e.current(),c){let e=u.get(c);e&&e()}}},[]),(0,s.jsx)("div",{ref:t,style:{width:"100dvw",height:"100dvh"},children:(0,s.jsx)("canvas",{ref:i,style:{width:"100%",height:"100%"}})})}},5120:(e,t,i)=>{Promise.resolve().then(i.bind(i,4489))}},e=>{e.O(0,[839,887,358],()=>e(e.s=5120)),_N_E=e.O()}]);